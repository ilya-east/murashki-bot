
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Murashki Player</title>
  <style>
    body {
      background: #1c1c1c;
      color: #fff;
      font-family: sans-serif;
    }

    .players-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 40px 10px;
      max-width: 1000px;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .player-column {
      width: calc(50% - 10px);
    }

    .custom-player {
      display: flex;
      align-items: center;
      background: #2d263a;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
      box-sizing: border-box;
      gap: 16px;
    }

    .custom-player img.cover {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .player-info {
      flex-grow: 1;
      overflow: hidden;
    }

    .player-title {
      font-weight: bold;
      font-size: 16px;
      color: #fff;
      white-space: normal;
      overflow-wrap: break-word;
    }

    .player-author {
      font-size: 13px;
      color: #ccc;
      margin-top: 2px;
    }

    .player-controls {
      display: flex;
      gap: 12px;
    }

    .btn {
      background: #3b3644;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .btn:hover {
      background: #5a4e68;
      transform: scale(1.08);
    }

    .like-count {
      font-size: 13px;
      color: #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 36px;
    }

    @media (max-width: 768px) {
      .player-column {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="players-container" id="players"></div>

  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBdmyEmyzp2eJK-wqkfCS-OSZrvQWy6Pg",
      authDomain: "murashki-6f04e.firebaseapp.com",
      databaseURL: "https://murashki-6f04e-default-rtdb.firebaseio.com",
      projectId: "murashki-6f04e",
      storageBucket: "murashki-6f04e.appspot.com",
      messagingSenderId: "687056541772",
      appId: "1:687056541772:web:2a037f46311812719bce9",
      measurementId: "G-8CCNCKGMQQ"
    };
    firebase.initializeApp(firebaseConfig);

    const audioFiles = [
      { title: "Кунай", author: "Murashki", file: "kunai.mp3", cover: "kunai.jpg" },
      { title: "Сигнал", author: "Murashki", file: "signal.mp3", cover: "signal.jpg" }
    ];

    const playersContainer = document.getElementById('players');

    audioFiles.forEach(track => {
      const div = document.createElement('div');
      div.className = 'player-column';
      div.innerHTML = `
        <div class="custom-player">
          <img class="cover" src="https://www.murashki-label.ru/music/${track.cover}" alt="cover">
          <div class="player-info">
            <div class="player-title">${track.title}</div>
            <div class="player-author">${track.author}</div>
          </div>
          <div class="player-controls">
            <button class="btn play-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#fff"><path d="M8 5v14l11-7z"/></svg>
            </button>
            <button class="btn like-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#fff"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 
              2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09
              C13.09 3.81 14.76 3 16.5 3 
              19.58 3 22 5.42 22 8.5
              c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            </button>
            <span class="like-count">0</span>
          </div>
          <audio src="https://www.murashki-label.ru/music/${track.file}"></audio>
        </div>
      `;
      playersContainer.appendChild(div);
    });

    let currentAudio = null;
    let currentBtn = null;

    function handlePlay(audio, btn) {
      if (currentAudio && currentAudio !== audio) {
        currentAudio.pause();
        if (currentBtn) {
          currentBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="#fff"><path d="M8 5v14l11-7z"/></svg>';
        }
      }

      if (audio.paused) {
        audio.play().catch(() => {});
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="#fff"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        currentAudio = audio;
        currentBtn = btn;
      } else {
        audio.pause();
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="#fff"><path d="M8 5v14l11-7z"/></svg>';
      }
    }

    setTimeout(() => {
      document.querySelectorAll('.custom-player').forEach(player => {
        const audio = player.querySelector('audio');
        const btn = player.querySelector('.play-btn');
        const likeBtn = player.querySelector('.like-btn');
        const likeCount = player.querySelector('.like-count');
        const trackId = audio.src.split('/').pop().split('.')[0];
        const dbRef = firebase.database().ref('likes/' + trackId);

        dbRef.on('value', snapshot => {
          likeCount.textContent = snapshot.val() || 0;
        });

        btn.addEventListener('click', () => handlePlay(audio, btn));

        likeBtn.addEventListener('click', () => {
          const userLiked = localStorage.getItem(`liked_${trackId}`);
          dbRef.transaction(currentLikes => {
            if (userLiked) {
              localStorage.removeItem(`liked_${trackId}`);
              likeBtn.querySelector('svg').setAttribute('fill', '#fff');
              return (currentLikes || 1) - 1;
            } else {
              localStorage.setItem(`liked_${trackId}`, 'true');
              likeBtn.querySelector('svg').setAttribute('fill', '#ff0000');
              return (currentLikes || 0) + 1;
            }
          });
        });

        if (localStorage.getItem(`liked_${trackId}`)) {
          likeBtn.querySelector('svg').setAttribute('fill', '#ff0000');
        }
      });
    }, 100);
  </script>
</body>
</html>
